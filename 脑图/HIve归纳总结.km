{"root":{"data":{"id":"0bf95b700eab","created":1552354673,"text":"HIve","expandState":"expand"},"children":[{"data":{"id":"bsl3tgngfm00","created":1552354709814,"text":"Hive优化","hyperlink":"http://www.cnblogs.com/frankdeng/p/9463897.html","hyperlinkTitle":"Hive调优","expandState":"collapse"},"children":[{"data":{"id":"bsl3wfkhjxc0","created":1552354942550,"text":"基于MapReduce优化","expandState":"expand"},"children":[{"data":{"id":"bsl3x9czeww0","created":1552355007399,"text":"合理设置map数、reduce数","expandState":"expand"},"children":[{"data":{"id":"bsl3y2kor200","created":1552355070992,"text":"考虑分片问题，保证一个map任务只处理一台节点上的block，避免数据跨网络传输的开销","expandState":"expand"},"children":[]},{"data":{"id":"bsl5hsbwj3s0","created":1552359437086,"text":"手动设置","expandState":"expand"},"children":[{"data":{"id":"bsl5hvmo5sw0","created":1552359444268,"text":"调整maxSize<blockSize来增加map数","expandState":"expand"},"children":[]},{"data":{"id":"bsl5jeuii8g0","created":1552359564465,"text":"增加reduce数较复杂，见文章","expandState":"expand"},"children":[]}]}]}]},{"data":{"id":"bsl3wlxv5e80","created":1552354956419,"text":"Hive架构层优化","expandState":"expand"},"children":[{"data":{"id":"bsl3zl1ztqg0","created":1552355189585,"text":"涉及hive如何读取hdfs上的数据","expandState":"expand"},"children":[{"data":{"id":"bsl3zvet84w0","created":1552355212128,"text":"直接抓取","note":"像`select * from table`不会启用MapReduce来读取\n\n或者抽样查询`select * from table limit 2`，在Hive中limit是抽样，会随机返回对应的记录数","expandState":"expand"},"children":[{"data":{"id":"bsl49xer29s0","created":1552356000119,"text":"hive-site.xml中设置hive.fetch.task.conversion=more","expandState":"expand"},"children":[]},{"data":{"id":"bsl4cnidgtk0","created":1552356213663,"text":"适合select、where、limit这些查询","expandState":"expand"},"children":[{"data":{"id":"bsl4h8ssgs80","created":1552356573462,"text":"全局查找、字段查找、limit查找等都不走mapreduce","expandState":"expand"},"children":[]}]}]},{"data":{"id":"bsl402lqxyo0","created":1552355227784,"text":"启用MapReduce读取","expandState":"expand"},"children":[{"data":{"id":"bsl4dbab2g80","created":1552356265418,"text":"考虑只是本地执行MapReduce","expandState":"expand"},"children":[{"data":{"id":"bsl4fpcxqqg0","created":1552356452780,"text":"设置参数hive.exec.mode.local.auto=true","expandState":"expand"},"children":[]}]},{"data":{"id":"bsl4es588z40","created":1552356380480,"text":"适合数据量小时，避免了分布式的跨网络传输、多节点协调等资源消耗","expandState":"expand"},"children":[]}]}]},{"data":{"id":"bsl4hxll6eg0","created":1552356627446,"text":"设置JVM重用","note":"启动一个map或reduce任务都会启动JVM进程，任务结束后优惠关闭JVM进程。\nJVM启动时间的开销是个问题\n","expandState":"expand"},"children":[{"data":{"id":"bsl4j135z4o0","created":1552356713403,"text":"设置参数 mapred.job.reduce.jvm.num.tasks=n（n可以是5、10等）","expandState":"expand"},"children":[]},{"data":{"id":"bsl4jvjfrbk0","created":1552356779691,"text":"表明执行完n个task后JVM才会退出","expandState":"expand"},"children":[]}]},{"data":{"id":"bsl4k60y1pc0","created":1552356802517,"text":"设置并行化","expandState":"expand"},"children":[{"data":{"id":"bsl4kjm9d600","created":1552356832104,"text":"MapReduce中job无依赖时，且资源足够时，并行处理可以提高执行速度","expandState":"expand"},"children":[]},{"data":{"id":"bsl4lbtgmds0","created":1552356893489,"text":"设置参数 hive.exec.parallel=true","expandState":"expand"},"children":[]}]}]},{"data":{"id":"bsl3wrqu0f40","created":1552354969055,"text":"HiveQL层优化","expandState":"expand"},"children":[{"data":{"id":"bsl4wrx5c6w0","created":1552357790547,"text":"利用分区表优化","expandState":"expand"},"children":[]},{"data":{"id":"bsl4wuilv0w0","created":1552357796198,"text":"利用桶表优化","expandState":"expand"},"children":[]},{"data":{"id":"bsl4y4mrc4g0","created":1552357896581,"text":"join优化","expandState":"expand"},"children":[{"data":{"id":"bsl52vugbfk0","created":1552358269276,"text":"先过滤再join，减少join的数据量","expandState":"expand"},"children":[]},{"data":{"id":"bsl536f2gxk0","created":1552358292290,"text":"小表join大表原则","progress":9,"expandState":"expand"},"children":[{"data":{"id":"bsl53klgaqg0","created":1552358323151,"text":"join中执行顺序是从左到右的","expandState":"expand"},"children":[]},{"data":{"id":"bsl53yrnm1c0","created":1552358354001,"text":"join的reduce阶段会把左表加载到内存中，小表可以降低内存溢出的可能","expandState":"expand"},"children":[]}]},{"data":{"id":"bsl5693dkv40","created":1552358533206,"text":"启用map join","expandState":"expand"},"children":[{"data":{"id":"bsl56e5cjp40","created":1552358544209,"text":"reduce阶段的join可能会造成数据倾斜，可以考虑把小表分发到map进程的内存中进行join操作，省去了reduce步骤","expandState":"expand"},"children":[]},{"data":{"id":"bsl57wkhkb40","created":1552358662671,"text":"hive.auto.convert.join = true（设置自动选择mapjoin，默认true）","expandState":"expand"},"children":[]},{"data":{"id":"bsl58fasvhc0","created":1552358703444,"text":"hive.mapjoin.smalltable.filesize=25000000（设置小表阈值，默认25M以下是小表）","expandState":"expand"},"children":[]}]},{"data":{"id":"bsl5fe9zzzc0","created":1552359249768,"text":"减少使用笛卡尔乘积查询","expandState":"expand"},"children":[{"data":{"id":"bsl5frqfcm00","created":1552359279059,"text":"Hive不会像一些关系型数据库一样把一些where转换成on语句，所以表很大时，笛卡尔查询不可控","expandState":"expand"},"children":[]}]}]},{"data":{"id":"bsl4z0vsqm00","created":1552357966784,"text":"group by优化（很容易导致数据倾斜）","expandState":"expand"},"children":[{"data":{"id":"bsl50aa7o600","created":1552358065611,"text":"key的数据过大时会造成数据倾斜问题，可以开启map端聚合","expandState":"expand"},"children":[]},{"data":{"id":"bsl50p0b6u80","created":1552358097664,"text":" hive.map.aggr = true（默认true）","expandState":"expand"},"children":[]},{"data":{"id":"bsl515qsoqo0","created":1552358134094,"text":"hive.groupby.mapaggr.checkinterval = 100000（map端聚合操作条目数目）","expandState":"expand"},"children":[]},{"data":{"id":"bsl51jauprk0","created":1552358163605,"text":"hive.groupby.skewindata = true（有数据倾斜时进行负载均衡，默认false）","expandState":"expand"},"children":[]}]},{"data":{"id":"bsl4y6j0ytk0","created":1552357900709,"text":"order by优化","expandState":"expand"},"children":[{"data":{"id":"bsl5d0f2k3c0","created":1552359062871,"text":"order by只能在一个reduce进程中执行，如果数据量很大时，造成执行很慢","expandState":"expand"},"children":[]},{"data":{"id":"bsl5ekm3bdk0","created":1552359185196,"text":"强制使用limit语句可以防止Reducer额外执行很长一段时间","expandState":"expand"},"children":[]}]}]}]},{"data":{"id":"bsl3tkryaao0","created":1552354718793,"text":"Hive客户端","expandState":"collapse"},"children":[{"data":{"id":"bsl3ts4ykls0","created":1552354734817,"text":"Cli命令行交互","expandState":"expand"},"children":[]},{"data":{"id":"bsl3txy85s80","created":1552354747470,"text":"HiveServer2客户端","expandState":"expand"},"children":[{"data":{"id":"bsl3uxh646g0","created":1552354824803,"text":"官方推荐","expandState":"expand"},"children":[]},{"data":{"id":"bsl3v088ye80","created":1552354830794,"text":"通过Thrift协议进行通信，可以连接不同语言，如\nJDBC、ODBC","layout_left_offset":{"x":-94,"y":9},"expandState":"expand"},"children":[]}]},{"data":{"id":"bsl3u3ap34w0","created":1552354759108,"text":"HWI/HUE客户端","expandState":"expand"},"children":[{"data":{"id":"bsl3ubk3l540","created":1552354777091,"text":"HWI是Hive自带的，粗糙，不用","expandState":"expand"},"children":[]},{"data":{"id":"bsl3umsj7bk0","created":1552354801545,"text":"HUE是Web页面和Hive交互","expandState":"expand"},"children":[]}]}]},{"data":{"id":"bsl5lw8gwog0","created":1552359759042,"text":"Hive内核（四部分组成）","expandState":"expand","layout":null},"children":[{"data":{"id":"bsl5m2v3lc80","created":1552359773471,"text":"解释器","expandState":"expand","layout":null},"children":[{"data":{"id":"bsl5mhvmk680","created":1552359806155,"text":"将HiveSQL语句转成语法树AST","expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"bsl5m5bw23s0","created":1552359778840,"text":"编译器","expandState":"expand","layout":null},"children":[{"data":{"id":"bsl5mu0cg6o0","created":1552359832562,"text":"将语法树编译为逻辑执行计划","expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"bsl5m6svxnk0","created":1552359782045,"text":"优化器","expandState":"expand","layout":null},"children":[{"data":{"id":"bsl5n3s05uo0","created":1552359853825,"text":"对逻辑执行计划进行优化","expandState":"expand","layout":null},"children":[]}]},{"data":{"id":"bsl5m8v9l600","created":1552359786542,"text":"执行器","expandState":"expand","layout":null},"children":[{"data":{"id":"bsl5nb763940","created":1552359869980,"text":"调用底层运行框架执行逻辑执行计划","expandState":"expand","layout":null},"children":[]}]}]},{"data":{"id":"bsl5o1cifpk0","created":1552359926899,"text":"Hive底层存储","expandState":"collapse"},"children":[{"data":{"id":"bsl5o8mvigw0","created":1552359942763,"text":"Hive把数据映射成数据库和表，数据库是存储在hdfs上，表的元数据metadata是存储在一些关系型数据库上（如mysql）","expandState":"expand"},"children":[]},{"data":{"id":"bsl5qante1s0","created":1552360103902,"text":"元数据存储在mysql上，和mysql通过metaStore服务交互","expandState":"expand"},"children":[]},{"data":{"id":"bsl5qsx3l5s0","created":1552360143645,"text":"元数据信息包括","expandState":"expand"},"children":[{"data":{"id":"bsl5qy4n0dc0","created":1552360154985,"text":"Owner","expandState":"expand"},"children":[]},{"data":{"id":"bsl5r11wj0w0","created":1552360161350,"text":"创建时间、最后修改时间","expandState":"expand"},"children":[]},{"data":{"id":"bsl5r9gbs9k0","created":1552360179637,"text":"Location","expandState":"expand"},"children":[]},{"data":{"id":"bsl5rdobndk0","created":1552360188827,"text":"Table Type（表类型，内部表、外部表）","expandState":"expand"},"children":[]},{"data":{"id":"bsl5rnh3veo0","created":1552360210159,"text":"字段信息","expandState":"expand"},"children":[]}]}]},{"data":{"id":"bsl5z2pn2s80","created":1552360791875,"text":"Hive基础语法","hyperlink":"https://zhuanlan.zhihu.com/p/53109097","hyperlinkTitle":"","expandState":"collapse"},"children":[{"data":{"id":"bslkx9449v40","created":1552402965732,"text":"Hive中DDL操作","hyperlink":"https://www.cnblogs.com/qingyunzong/p/8723271.html","hyperlinkTitle":"","expandState":"expand"},"children":[]}]},{"data":{"id":"bsl5zuwl2x40","created":1552360853245,"text":"HSQL是如何转换成MR作业的？","hyperlink":"https://www.jianshu.com/p/660fd157c5eb","hyperlinkTitle":"HSQL转换成MapReduce过程","expandState":"expand"},"children":[]},{"data":{"id":"bsllhxa5aow0","created":1552404585622,"text":"常见问题收纳"},"children":[{"data":{"id":"bslli0wwjts0","created":1552404593529,"text":"Hive中文乱码问题","hyperlink":"https://www.cnblogs.com/qingyunzong/p/8724155.html","hyperlinkTitle":""},"children":[{"data":{"id":"bsllih8wttk0","created":1552404629083,"text":"修改元数据库中表、视图、分区的编码为utf8"},"children":[]},{"data":{"id":"bsllizp1vns0","created":1552404669241,"text":"修改metaStore连接的url"},"children":[]}]}]}]},"template":"default","theme":"fresh-blue","version":"1.4.43"}